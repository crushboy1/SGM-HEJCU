<div class="min-h-screen bg-hospital-bg">
  <div class="max-w-7xl mx-auto p-4 md:p-6 space-y-6">

    <!-- ================================================================
         HEADER: Usuario + Indicador SignalR + Acciones
         ================================================================ -->
    <header class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <!-- Usuario Info -->
      <div>
        <h1 class="text-2xl md:text-3xl font-bold text-sgm-dark tracking-tight">
          Panel de Control
        </h1>
        <div class="flex items-center gap-2 mt-2">
          <span class="text-sm text-gray-600">
            Bienvenido, <strong class="text-gray-800">{{ userName }}</strong>
          </span>
          <span class="text-gray-300">|</span>

          <!-- Indicador SignalR -->
          <div class="flex items-center gap-1.5 bg-white px-2.5 py-1 rounded-full border border-gray-200 shadow-sm hover:shadow-md transition-shadow"
               [title]="conexionSignalREstablecida ? 'Conexión en tiempo real activa' : 'Conectando...'">
            <span class="relative flex h-2.5 w-2.5">
              <span *ngIf="conexionSignalREstablecida"
                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
              <span class="relative inline-flex rounded-full h-2.5 w-2.5"
                    [ngClass]="conexionSignalREstablecida ? 'bg-green-500' : 'bg-yellow-500'"></span>
            </span>
            <span class="text-[11px] font-mono text-gray-600 font-medium">
              {{ ultimaActualizacionSignalR ? (ultimaActualizacionSignalR | date:'HH:mm:ss') : '--:--:--' }}
            </span>
          </div>
        </div>
      </div>

      <!-- ⭐ NUEVO: Botón Actualizar con color cyan del hospital -->
      <button (click)="recargarDatos()"
              [disabled]="isLoadingKPIs"
              class="bg-hospital-cyan text-white px-5 py-2.5 rounded-lg font-medium text-sm flex items-center gap-2
                     shadow-md hover:bg-cyan-700 hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
              [class.opacity-50]="isLoadingKPIs">
        <app-icon name="refresh-cw"
                  [size]="16"
                  [class.animate-spin]="isLoadingKPIs"></app-icon>
        <span>{{ isLoadingKPIs ? 'Actualizando...' : 'Actualizar' }}</span>
      </button>
    </header>

    <!-- ================================================================
         ALERTAS DEL SISTEMA (Fondo rojo muy claro casi blanco)
         ================================================================ -->
    <section *ngIf="tieneAlertasCriticas || tieneAlertas24h || tieneSolicitudesAlerta"
             id="alertas-sistema"
             class="bg-gradient-to-r from-red-50/30 to-red-100/30 border-l-4 border-red-400 p-4 md:p-5 rounded-lg shadow-md animate-fade-in"
             role="alert"
             aria-live="assertive">
      <div class="flex items-start gap-3">
        <div class="text-red-600 flex-shrink-0 mt-0.5">
          <app-icon name="alert-triangle" [size]="24"></app-icon>
        </div>

        <div class="flex-1">
          <h3 class="font-bold text-red-900 mb-3 text-base flex items-center gap-2">
            <app-icon name="alert-circle" [size]="18"></app-icon>
            Alertas del Sistema
          </h3>
          <ul class="space-y-2 text-sm">
            <!-- Alerta Crítica (>48h) -->
            <li *ngIf="tieneAlertasCriticas"
                class="flex items-center gap-2 bg-red-100/50 p-2.5 rounded-lg border border-red-200 animate-fade-in-up">
              <app-icon name="alert-triangle" [size]="16" class="text-red-700 flex-shrink-0"></app-icon>
              <span class="text-red-900">
                <strong>{{ kpis?.bandejas?.conAlerta48h || 0 }}</strong> expediente(s) con más de
                <strong class="text-red-700">48 horas</strong> en mortuorio
              </span>
            </li>

            <!-- Alerta Media (>24h) -->
            <li *ngIf="tieneAlertas24h"
                class="flex items-center gap-2 bg-yellow-100/50 p-2.5 rounded-lg border border-yellow-200 animate-fade-in-up animate-delay-100">
              <app-icon name="clock" [size]="16" class="text-yellow-700 flex-shrink-0"></app-icon>
              <span class="text-yellow-900">
                <strong>{{ kpis?.bandejas?.conAlerta24h || 0 }}</strong> expediente(s) con más de
                <strong class="text-yellow-700">24 horas</strong> en mortuorio
              </span>
            </li>

            <!-- Alerta Solicitudes Urgentes -->
            <li *ngIf="tieneSolicitudesAlerta"
                class="flex items-center gap-2 bg-orange-100/50 p-2.5 rounded-lg border border-orange-200 animate-fade-in-up animate-delay-200">
              <app-icon name="clipboard-list" [size]="16" class="text-orange-700 flex-shrink-0"></app-icon>
              <span class="text-orange-900">
                <strong>{{ kpis?.solicitudes?.conAlerta || 0 }}</strong> solicitud(es) de corrección
                <strong class="text-orange-700">urgentes</strong>
              </span>
            </li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ================================================================
         KPI CARDS: Títulos descriptivos + Backgrounds suaves
         ================================================================ -->
    <section id="kpi-cards"
             [ngClass]="kpis?.deudas
           ? 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 md:gap-6'
           : 'grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6'">

      <!-- Card 1: Bandejas Libres (antes "Disponibles") -->
      <article class="bg-gradient-to-br from-green-50 to-green-100/50 rounded-xl shadow-md border border-green-200
                      hover:shadow-lg transition-all duration-300 overflow-hidden">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold text-green-700 uppercase tracking-wider mb-1">
                Bandejas Libres
              </p>
              <p class="text-3xl font-bold text-green-600">
                {{ kpis?.bandejas?.disponibles || 0 }}
              </p>
            </div>
            <div class="p-3 bg-green-200/50 rounded-xl text-green-600">
              <app-icon name="archive" [size]="28"></app-icon>
            </div>
          </div>
          <div class="flex items-center gap-2 text-xs text-green-700">
            <div class="w-2 h-2 rounded-full bg-green-500"></div>
            <span>de {{ kpis?.bandejas?.total || 0 }} totales</span>
          </div>
        </div>
      </article>

      <!-- Card 2: Bandejas en Uso (antes "Ocupadas") -->
      <article class="bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-xl shadow-md border border-blue-200
                      hover:shadow-lg transition-all duration-300 overflow-hidden animate-delay-100">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold text-blue-700 uppercase tracking-wider mb-1">
                Bandejas en Uso
              </p>
              <p class="text-3xl font-bold text-blue-600">
                {{ kpis?.bandejas?.ocupadas || 0 }}
              </p>
            </div>
            <div class="p-3 bg-blue-200/50 rounded-xl text-blue-600">
              <app-icon name="clipboard-list" [size]="28"></app-icon>
            </div>
          </div>
          <!-- Barra de Progreso -->
          <div class="flex items-center gap-2">
            <div class="flex-1 bg-blue-200/40 rounded-full h-2 overflow-hidden">
              <div class="h-full rounded-full transition-all duration-500"
                   [ngClass]="uiState.progressBarClass"
                   [style.width.%]="kpis?.bandejas?.porcentajeOcupacion || 0">
              </div>
            </div>
            <span class="text-xs font-bold" [ngClass]="uiState.ocupacionColor">
              {{ (kpis?.bandejas?.porcentajeOcupacion || 0) | number:'1.0-1' }}%
            </span>
          </div>
        </div>
      </article>

      <!-- Card 3: Solicitudes Pendientes (antes "Correcciones") -->
      <article class="bg-gradient-to-br from-yellow-50 to-yellow-100/50 rounded-xl shadow-md border border-yellow-200
                      hover:shadow-lg transition-all duration-300 overflow-hidden animate-delay-200">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold text-yellow-700 uppercase tracking-wider mb-1">
                Solicitudes Pendientes
              </p>
              <p class="text-3xl font-bold text-yellow-600">
                {{ kpis?.solicitudes?.pendientes || 0 }}
              </p>
            </div>
            <div class="p-3 bg-yellow-200/50 rounded-xl text-yellow-600">
              <app-icon name="file-check" [size]="28"></app-icon>
            </div>
          </div>
          <div class="flex items-center gap-2 text-xs text-yellow-700">
            <div class="w-2 h-2 rounded-full bg-green-500"></div>
            <span>{{ kpis?.solicitudes?.resueltas || 0 }} resueltas hoy</span>
          </div>
        </div>
      </article>

      <!-- Card 4: Retiros Hoy (antes "Salidas") -->
      <article class="bg-gradient-to-br from-purple-50 to-purple-100/50 rounded-xl shadow-md border border-purple-200
                      hover:shadow-lg transition-all duration-300 overflow-hidden animate-delay-300">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold text-purple-700 uppercase tracking-wider mb-1">
                Retiros Hoy
              </p>
              <p class="text-3xl font-bold text-purple-600">
                {{ kpis?.salidas?.totalSalidas || 0 }}
              </p>
            </div>
            <div class="p-3 bg-purple-200/50 rounded-xl text-purple-600">
              <app-icon name="log-out" [size]="28"></app-icon>
            </div>
          </div>
          <div class="flex items-center gap-2 text-xs">
            <ng-container *ngIf="(kpis?.salidas?.conIncidentes || 0) > 0; else sinIncidentes">
              <div class="w-2 h-2 rounded-full bg-red-500"></div>
              <span class="text-red-600 font-medium">
                {{ kpis?.salidas?.conIncidentes || 0 }} con incidentes
              </span>
            </ng-container>
            <ng-template #sinIncidentes>
              <div class="w-2 h-2 rounded-full bg-green-500"></div>
              <span class="text-purple-700">Sin incidentes hoy</span>
            </ng-template>
          </div>
        </div>
      </article>
      <!-- Card 5: Deudas de Sangre Pendientes (Solo para roles autorizados) -->
      <article *ngIf="kpis?.deudas"
               class="bg-gradient-to-br from-red-50 to-red-100/50 rounded-xl shadow-md border border-red-200
                hover:shadow-lg transition-all duration-300 overflow-hidden animate-delay-100">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold text-red-700 uppercase tracking-wider mb-1">
                Deudas Sangre Pendientes
              </p>
              <p class="text-3xl font-bold text-red-600">
                {{ kpis?.deudas?.sangrePendientes || 0 }}
              </p>
            </div>
            <div class="p-3 bg-red-200/50 rounded-xl text-red-600">
              <app-icon name="droplet" [size]="28"></app-icon>
            </div>
          </div>
          <div class="flex items-center gap-2 text-xs text-red-700">
            <div class="w-2 h-2 rounded-full bg-red-500"></div>
            <span>{{ kpis?.deudas?.sangreAnuladas || 0 }} anuladas</span>
          </div>
        </div>
      </article>

      <!-- Card 6: Deudas Económicas Pendientes -->
      <article *ngIf="kpis?.deudas"
               class="bg-gradient-to-br from-orange-50 to-orange-100/50 rounded-xl shadow-md border border-orange-200
                hover:shadow-lg transition-all duration-300 overflow-hidden animate-delay-200">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold text-orange-700 uppercase tracking-wider mb-1">
                Deudas Económicas
              </p>
              <p class="text-3xl font-bold text-orange-600">
                {{ kpis?.deudas?.economicasPendientes || 0 }}
              </p>
            </div>
            <div class="p-3 bg-orange-200/50 rounded-xl text-orange-600">
              <app-icon name="credit-card" [size]="28"></app-icon>
            </div>
          </div>
          <div class="flex items-center gap-2 text-xs text-orange-700">
            <div class="w-2 h-2 rounded-full bg-orange-500"></div>
            <span>S/ {{ (kpis?.deudas?.montoTotalPendiente || 0) | number:'1.2-2' }}</span>
          </div>
        </div>
      </article>

      <!-- Card 7: Exoneraciones Aplicadas -->
      <article *ngIf="kpis?.deudas"
               class="bg-gradient-to-br from-purple-50 to-purple-100/50 rounded-xl shadow-md border border-purple-200
                hover:shadow-lg transition-all duration-300 overflow-hidden animate-delay-300">
        <div class="p-5">
          <div class="flex items-center justify-between mb-4">
            <div>
              <p class="text-xs font-semibold text-purple-700 uppercase tracking-wider mb-1">
                Exoneraciones
              </p>
              <p class="text-3xl font-bold text-purple-600">
                {{ kpis?.deudas?.economicasExoneradas || 0 }}
              </p>
            </div>
            <div class="p-3 bg-purple-200/50 rounded-xl text-purple-600">
              <app-icon name="file-badge" [size]="28"></app-icon>
            </div>
          </div>
          <div class="flex items-center gap-2 text-xs text-purple-700">
            <div class="w-2 h-2 rounded-full bg-purple-500"></div>
            <span>S/ {{ (kpis?.deudas?.montoTotalExonerado || 0) | number:'1.2-2' }}</span>
          </div>
        </div>
      </article>
    </section>

    <!-- ================================================================
         ESTADO DEL MORTUORIO (Background suave)
         ================================================================ -->
    <section id="estado-mortuorio"
             class="bg-gradient-to-br from-gray-50 to-slate-100/50 rounded-xl shadow-md border border-gray-200
                    overflow-hidden animate-fade-in-up animate-delay-400">
      <div class="p-5 md:p-6">

        <!-- Header -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6">
          <div class="flex items-center gap-3">
            <div class="p-2.5 bg-gray-200/50 rounded-lg text-gray-600">
              <app-icon name="building-2" [size]="24"></app-icon>
            </div>
            <h3 class="text-lg md:text-xl font-bold text-gray-800">
              Estado del Mortuorio
            </h3>
          </div>
          <span class="px-3 py-1.5 rounded-full text-xs font-semibold border shadow-sm"
                [ngClass]="uiState.ocupacionBadgeClass">
            {{ (kpis?.bandejas?.porcentajeOcupacion || 0) | number:'1.0-1' }}% Ocupación
          </span>
        </div>

        <!-- Barra de Progreso Grande -->
        <div class="w-full bg-gray-200/60 rounded-full h-7 overflow-hidden mb-6 shadow-inner border border-gray-300">
          <div class="h-full transition-all duration-700 rounded-full flex items-center justify-end px-3"
               [style.width.%]="kpis?.bandejas?.porcentajeOcupacion || 0"
               [ngClass]="uiState.progressBarClass">
            <span class="text-white text-sm font-bold drop-shadow-md"
                  *ngIf="(kpis?.bandejas?.porcentajeOcupacion || 0) > 15">
              {{ (kpis?.bandejas?.porcentajeOcupacion || 0) | number:'1.0-1' }}%
            </span>
          </div>
        </div>

        <!-- Grid Estadísticas -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 md:gap-6">

          <!-- Disponibles -->
          <div class="bg-gradient-to-br from-green-100/40 to-green-50 rounded-lg p-4 border border-green-200 text-center">
            <div class="text-3xl font-bold text-green-600 mb-1">
              {{ kpis?.bandejas?.disponibles || 0 }}
            </div>
            <div class="flex items-center justify-center gap-1.5 text-xs text-green-700 font-medium">
              <app-icon name="check-circle" [size]="14"></app-icon>
              <span>Disponibles</span>
            </div>
          </div>

          <!-- Ocupadas -->
          <div class="bg-gradient-to-br from-blue-100/40 to-blue-50 rounded-lg p-4 border border-blue-200 text-center">
            <div class="text-3xl font-bold text-blue-600 mb-1">
              {{ kpis?.bandejas?.ocupadas || 0 }}
            </div>
            <div class="flex items-center justify-center gap-1.5 text-xs text-blue-700 font-medium">
              <app-icon name="user" [size]="14"></app-icon>
              <span>Ocupadas</span>
            </div>
          </div>

          <!-- Mantenimiento -->
          <div class="bg-gradient-to-br rounded-lg p-4 border text-center transition-all duration-300"
               [ngClass]="(kpis?.bandejas?.enMantenimiento || 0) > 0
                          ? 'from-orange-100/40 to-orange-50 border-orange-200'
                          : 'from-gray-100/40 to-gray-50 border-gray-200'">
            <div class="text-3xl font-bold mb-1"
                 [ngClass]="uiState.mantenimientoTextColor">
              {{ kpis?.bandejas?.enMantenimiento || 0 }}
            </div>
            <div class="flex items-center justify-center gap-1.5 text-xs font-medium"
                 [ngClass]="uiState.mantenimientoTextColor">
              <app-icon name="settings" [size]="14"></app-icon>
              <span>Mantenimiento</span>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- ================================================================
         ACCESO RÁPIDO (Backgrounds suaves)
         ================================================================ -->
    <section id="acceso-rapido">
      <h2 class="text-base md:text-lg font-bold text-gray-700 mb-4 uppercase tracking-wide flex items-center gap-2">
        <span class="text-hospital-cyan">
          <app-icon name="zap" [size]="20"></app-icon>
        </span>
        Acceso Rápido
      </h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">

        <!-- Card 1: Nuevo Ingreso -->
        <button (click)="navigateTo('/nuevo-expediente')"
                class="bg-gradient-to-br from-cyan-50 to-cyan-100/50 rounded-xl shadow-md border border-cyan-200
                       hover:shadow-xl hover:scale-[1.02] transition-all duration-300 text-left overflow-hidden group">
          <div class="p-5">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-gray-800 text-base group-hover:text-hospital-cyan transition-colors">
                Nuevo Ingreso
              </h3>
              <div class="p-3 bg-cyan-200/50 rounded-xl text-hospital-cyan group-hover:bg-cyan-300/70 transition-colors">
                <app-icon name="file-plus" [size]="24"></app-icon>
              </div>
            </div>
            <p class="text-sm text-gray-600">
              Registrar un nuevo fallecido en piso o externo
            </p>
          </div>
        </button>

        <!-- Card 2: Bandeja Entrada -->
        <button (click)="navigateTo('/bandeja-entrada')"
                class="bg-gradient-to-br from-green-50 to-green-100/50 rounded-xl shadow-md border border-green-200
                       hover:shadow-xl hover:scale-[1.02] transition-all duration-300 text-left overflow-hidden group">
          <div class="p-5">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-gray-800 text-base group-hover:text-hospital-green transition-colors">
                Bandeja Entrada
              </h3>
              <div class="p-3 bg-green-200/50 rounded-xl text-hospital-green group-hover:bg-green-300/70 transition-colors">
                <app-icon name="inbox" [size]="24"></app-icon>
              </div>
            </div>
            <p class="text-sm text-gray-600">
              Ver expedientes pendientes de tu servicio
            </p>
          </div>
        </button>

        <!-- Card 3: Gestión Mortuorio -->
        <button (click)="navigateTo('/mapa-mortuorio')"
                class="bg-gradient-to-br from-blue-50 to-blue-100/50 rounded-xl shadow-md border border-blue-200
                       hover:shadow-xl hover:scale-[1.02] transition-all duration-300 text-left overflow-hidden group">
          <div class="p-5">
            <div class="flex items-center justify-between mb-4">
              <h3 class="font-bold text-gray-800 text-base group-hover:text-hospital-blue transition-colors">
                Gestión Mortuorio
              </h3>
              <div class="p-3 bg-blue-200/50 rounded-xl text-hospital-blue group-hover:bg-blue-300/70 transition-colors">
                <app-icon name="building-2" [size]="24"></app-icon>
              </div>
            </div>
            <p class="text-sm text-gray-600">
              Gestionar bandejas y ocupación del mortuorio
            </p>
            <div class="mt-3 flex items-center gap-1.5 text-xs font-semibold text-hospital-blue opacity-0 group-hover:opacity-100 transition-opacity">
              <span>Acceder</span>
              <app-icon name="chevron-right" [size]="14"></app-icon>
            </div>
          </div>
        </button>

      </div>
    </section>

    <!-- ================================================================
         TABLA: Expedientes Recientes con FILTROS + PAGINACIÓN
         ================================================================ -->
    <section id="expedientes-recientes"
             class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden animate-fade-in-up animate-delay-600">

      <!-- Header Tabla -->
      <div class="px-4 md:px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4">
          <div class="flex items-center gap-3">
            <div class="text-gray-500">
              <app-icon name="clock" [size]="20"></app-icon>
            </div>
            <h3 class="font-bold text-gray-800 text-base md:text-lg">
              Expedientes Recientes
            </h3>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-xs text-gray-600 font-medium bg-white px-2.5 py-1 rounded-lg border border-gray-200 shadow-sm">
              Total: {{ expedientesFiltrados.length || 0 }}
            </span>
            <button (click)="recargarDatos()"
                    class="p-2 text-gray-400 hover:text-hospital-cyan hover:bg-cyan-50 rounded-lg transition-all hover:scale-110"
                    title="Actualizar lista"
                    [disabled]="isLoadingExpedientes">
              <app-icon name="refresh-cw"
                        [size]="18"
                        [class.animate-spin]="isLoadingExpedientes"></app-icon>
            </button>
          </div>
        </div>

        <!-- ⭐ NUEVO: Barra de Filtros -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <!-- Búsqueda -->
          <div class="relative md:col-span-2">
            <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
              <app-icon name="search" [size]="18"></app-icon>
            </div>
            <input type="text"
                   [(ngModel)]="filtros.busqueda"
                   (ngModelChange)="aplicarFiltros()"
                   placeholder="Buscar por HC, nombre o documento..."
                   class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg bg-white
                          focus:ring-2 focus:ring-hospital-cyan focus:border-transparent outline-none text-sm">
          </div>

          <!-- Filtro Estado -->
          <div class="flex gap-2">
            <select [(ngModel)]="filtros.estado"
                    (ngModelChange)="aplicarFiltros()"
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-white
                           focus:ring-2 focus:ring-hospital-cyan focus:border-transparent outline-none text-sm">
              <option value="">Todos los estados</option>
              <option value="EnPiso">En Piso</option>
              <option value="PendienteDeRecojo">Pendiente Recojo</option>
              <option value="EnTrasladoMortuorio">En Traslado</option>
              <option value="EnBandeja">En Bandeja</option>
              <option value="PendienteRetiro">Pendiente Retiro</option>
              <option value="Retirado">Retirado</option>
            </select>

            <button (click)="limpiarFiltros()"
                    class="px-3 py-2 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                    title="Limpiar filtros">
              <app-icon name="x" [size]="18"></app-icon>
            </button>
          </div>
        </div>
      </div>

      <!-- Tabla -->
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead class="bg-gray-50 text-xs uppercase font-bold text-gray-600 border-b border-gray-200">
            <tr>
              <th class="px-4 md:px-6 py-4 text-center whitespace-nowrap">Código</th>
              <th class="px-4 md:px-6 py-4 text-left whitespace-nowrap cursor-pointer hover:bg-gray-100 transition-colors"
                  (click)="ordenarPor('nombre')">
                <div class="flex items-center gap-1">
                  <span>Paciente</span>
                  <app-icon name="chevrons-up-down" [size]="14" class="text-gray-400"></app-icon>
                </div>
              </th>
              <th class="px-4 md:px-6 py-4 text-center whitespace-nowrap cursor-pointer hover:bg-gray-100 transition-colors"
                  (click)="ordenarPor('hc')">
                <div class="flex items-center justify-center gap-1">
                  <span>HC</span>
                  <app-icon name="chevrons-up-down" [size]="14" class="text-gray-400"></app-icon>
                </div>
              </th>
              <th class="px-4 md:px-6 py-4 text-center whitespace-nowrap">Servicio</th>
              <th class="px-4 md:px-6 py-4 text-center whitespace-nowrap cursor-pointer hover:bg-gray-100 transition-colors"
                  (click)="ordenarPor('fecha')">
                <div class="flex items-center justify-center gap-1">
                  <span>Fecha</span>
                  <app-icon name="chevrons-up-down" [size]="14" class="text-gray-400"></app-icon>
                </div>
              </th>
              <th class="px-4 md:px-6 py-4 text-center whitespace-nowrap">Estado</th>
              <th class="px-4 md:px-6 py-4 text-center whitespace-nowrap">Acciones</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">

            <!-- Estado: Cargando -->
            <tr *ngIf="isLoadingExpedientes">
              <td colspan="7" class="px-6 py-16 text-center">
                <div class="flex flex-col items-center gap-3">
                  <div class="animate-spin text-hospital-cyan">
                    <app-icon name="refresh-cw" [size]="36"></app-icon>
                  </div>
                  <span class="text-gray-600 font-medium">Cargando expedientes...</span>
                </div>
              </td>
            </tr>

            <!-- Estado: Error -->
            <tr *ngIf="errorExpedientes && !isLoadingExpedientes">
              <td colspan="7" class="px-6 py-12 text-center">
                <div class="flex flex-col items-center gap-3 text-red-600">
                  <app-icon name="alert-circle" [size]="32"></app-icon>
                  <p class="font-medium">{{ errorExpedientes }}</p>
                  <button (click)="recargarDatos()"
                          class="bg-hospital-cyan text-white px-4 py-2 rounded-lg text-sm mt-2 hover:bg-cyan-700">
                    Reintentar
                  </button>
                </div>
              </td>
            </tr>

            <!-- Estado: Vacío -->
            <tr *ngIf="!isLoadingExpedientes && !errorExpedientes && expedientesPaginados?.length === 0">
              <td colspan="7" class="px-6 py-16 text-center">
                <div class="flex flex-col items-center gap-3 text-gray-400">
                  <app-icon name="inbox" [size]="56"></app-icon>
                  <p class="font-medium text-gray-600">
                    {{ filtros.busqueda || filtros.estado ? 'No se encontraron resultados' : 'No hay expedientes registrados' }}
                  </p>
                  <button *ngIf="!filtros.busqueda && !filtros.estado"
                          (click)="navigateTo('/nuevo-expediente')"
                          class="bg-hospital-cyan text-white px-4 py-2 rounded-lg text-sm mt-2 hover:bg-cyan-700">
                    Crear Primer Expediente
                  </button>
                </div>
              </td>
            </tr>

            <!-- ⭐ MODIFICADO: Usar expedientesPaginados en lugar de expedientesRecientes -->
            <tr *ngFor="let item of expedientesPaginados"
                class="hover:bg-blue-50/50 transition-all cursor-pointer group"
                (click)="verExpediente(item?.expedienteID)">

              <!-- Código -->
              <td class="px-4 md:px-6 py-4 text-center">
                <span class="font-mono text-sm font-bold text-hospital-cyan group-hover:text-blue-700 transition-colors">
                  {{ item?.codigoExpediente || item?.expedienteID || 'N/A' }}
                </span>
              </td>

              <!-- Paciente -->
              <td class="px-4 md:px-6 py-4 text-left">
                <div class="font-semibold text-gray-800 truncate max-w-xs"
                     [title]="item?.nombreCompleto">
                  {{ item?.nombreCompleto || 'Sin nombre' }}
                </div>
              </td>

              <!-- HC -->
              <td class="px-4 md:px-6 py-4 text-center">
                <div class="inline-flex items-center gap-1 text-gray-600">
                  <app-icon name="hash" [size]="12" class="text-gray-400"></app-icon>
                  <span class="font-medium">{{ item?.hc || 'N/A' }}</span>
                </div>
              </td>

              <!-- Servicio -->
              <td class="px-4 md:px-6 py-4 text-center">
                <span class="text-gray-600 truncate max-w-xs inline-block" [title]="item?.servicioFallecimiento">
                  {{ item?.servicioFallecimiento || 'N/A' }}
                </span>
              </td>

              <!-- Fecha -->
              <td class="px-4 md:px-6 py-4 text-center">
                <div class="flex flex-col items-center">
                  <span class="font-medium text-gray-700">
                    {{ item?.fechaHoraFallecimiento | date:'dd/MM/yyyy' }}
                  </span>
                  <span class="text-xs text-gray-400">
                    {{ item?.fechaHoraFallecimiento | date:'HH:mm' }}
                  </span>
                </div>
              </td>

              <!-- Estado -->
              <td class="px-4 md:px-6 py-4 text-center">
                <ng-container *ngIf="getBadgeInfo(item?.estadoActual || '') as badge">
                  <span [class]="badge.classes + ' shadow-sm whitespace-nowrap'">
                    <app-icon [name]="badge.icon" [size]="14"></app-icon>
                    <span>{{ badge.label }}</span>
                  </span>
                </ng-container>
              </td>

              <!-- Acciones -->
              <td class="px-4 md:px-6 py-4">
                <div class="flex items-center justify-center gap-2">
                  <button *ngIf="item.estadoActual === 'EnPiso' || item.estadoActual === 'PendienteDeRecojo'"
                          (click)="reimprimir(item.expedienteID); $event.stopPropagation()"
                          class="p-2 text-gray-400 hover:text-purple-600 hover:bg-purple-50 rounded-lg transition-colors"
                          title="Reimprimir Brazalete">
                    <app-icon name="printer" [size]="18"></app-icon>
                  </button>

                  <button (click)="verExpediente(item?.expedienteID); $event.stopPropagation()"
                          class="p-2 text-gray-400 hover:text-hospital-cyan hover:bg-cyan-50 rounded-lg transition-colors group-hover:text-hospital-cyan"
                          title="Ver detalle">
                    <app-icon name="eye" [size]="18"></app-icon>
                  </button>
                </div>
              </td>
            </tr>

          </tbody>
        </table>
      </div>

      <!-- ⭐ NUEVO: Paginación -->
      <div *ngIf="expedientesFiltrados.length > 0"
           class="px-4 md:px-6 py-4 bg-gray-50 border-t border-gray-200 flex flex-col sm:flex-row justify-between items-center gap-3">

        <!-- Info de paginación -->
        <div class="text-sm text-gray-600">
          Mostrando
          <span class="font-semibold">{{ (paginaActual - 1) * itemsPorPagina + 1 }}</span>
          -
          <span class="font-semibold">{{ Math.min(paginaActual * itemsPorPagina, expedientesFiltrados.length) }}</span>
          de
          <span class="font-semibold">{{ expedientesFiltrados.length }}</span>
          expedientes
        </div>

        <!-- Controles de paginación -->
        <div class="flex items-center gap-2">
          <button (click)="irAPagina(paginaActual - 1)"
                  [disabled]="paginaActual === 1"
                  class="px-3 py-1.5 border border-gray-300 rounded-lg text-sm font-medium
                         disabled:opacity-50 disabled:cursor-not-allowed
                         hover:bg-gray-100 transition-colors">
            Anterior
          </button>

          <div class="flex gap-1">
            <button *ngFor="let p of paginasVisibles"
                    (click)="irAPagina(p)"
                    [class.bg-hospital-cyan]="p === paginaActual"
                    [class.text-white]="p === paginaActual"
                    [class.hover:bg-gray-100]="p !== paginaActual"
                    class="w-9 h-9 rounded-lg border border-gray-300 text-sm font-medium transition-colors">
              {{ p }}
            </button>
          </div>

          <button (click)="irAPagina(paginaActual + 1)"
                  [disabled]="paginaActual === totalPaginas"
                  class="px-3 py-1.5 border border-gray-300 rounded-lg text-sm font-medium
                         disabled:opacity-50 disabled:cursor-not-allowed
                         hover:bg-gray-100 transition-colors">
            Siguiente
          </button>
        </div>
      </div>

    </section>

  </div>
</div>

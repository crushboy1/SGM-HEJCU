<div class="min-h-screen bg-hospital-bg">

  <!-- ===================================================================
       HEADER MODERNO (Optimizado para Tablet)
       =================================================================== -->
  <div class="bg-gradient-to-r from-hospital-cyan to-cyan-700 border-b border-cyan-800 px-6 py-5 sticky top-0 z-10 shadow-lg">
    <div class="max-w-6xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
        <div class="p-3 bg-white/20 backdrop-blur-sm rounded-xl shadow-md text-white">
          <app-icon name="truck" [size]="32"></app-icon>
        </div>
        <div>
          <h1 class="text-2xl font-bold text-white">Mis Traslados</h1>
          <p class="text-sm text-cyan-100">Unidad Móvil Activa • {{ userName }}</p>
        </div>
      </div>

      <!-- Botón recargar -->
      <button (click)="cargarDatos()"
              [disabled]="isLoading"
              class="p-3 text-white hover:bg-white/20 rounded-lg transition-all hover:scale-110
                     disabled:opacity-50 disabled:cursor-not-allowed"
              title="Actualizar tareas">
        <app-icon name="refresh-cw" [size]="24" [className]="isLoading ? 'animate-spin' : ''"></app-icon>
      </button>
    </div>
  </div>

  <!-- ===================================================================
       CONTENIDO PRINCIPAL (Grid para Tablet)
       =================================================================== -->
  <div class="max-w-6xl mx-auto p-6 space-y-6">

    <!-- ===================================================================
         KPIs TABS (Más grandes para tablet)
         =================================================================== -->
    <div class="grid grid-cols-2 gap-6">

      <!-- Tab: Pendientes -->
      <button (click)="cambiarTab('pendientes')"
              [class.bg-white]="activeTab === 'pendientes'"
              [class.border-hospital-cyan]="activeTab === 'pendientes'"
              [class.shadow-lg]="activeTab === 'pendientes'"
              [class.bg-gray-50]="activeTab !== 'pendientes'"
              [class.border-gray-200]="activeTab !== 'pendientes'"
              class="relative p-6 rounded-2xl shadow-md border-2 transition-all hover:shadow-xl text-left">

        <!-- Badge Notificación -->
        <div *ngIf="kpiPendientes > 0 && activeTab !== 'pendientes'"
             class="absolute -top-3 -right-3 bg-red-500 text-white text-sm font-bold w-10 h-10
                    rounded-full flex items-center justify-center animate-pulse shadow-lg border-4 border-white">
          {{ kpiPendientes }}
        </div>

        <div class="flex items-center justify-between mb-3">
          <div class="p-4 rounded-xl"
               [class.bg-cyan-100]="activeTab === 'pendientes'"
               [class.text-hospital-cyan]="activeTab === 'pendientes'"
               [class.bg-gray-100]="activeTab !== 'pendientes'"
               [class.text-gray-500]="activeTab !== 'pendientes'">
            <app-icon name="bell" [size]="32"></app-icon>
          </div>
          <div class="text-right">
            <p class="text-5xl font-bold"
               [class.text-hospital-cyan]="activeTab === 'pendientes'"
               [class.text-gray-600]="activeTab !== 'pendientes'">
              {{ kpiPendientes }}
            </p>
          </div>
        </div>

        <p class="text-sm font-bold uppercase tracking-wide"
           [class.text-hospital-cyan]="activeTab === 'pendientes'"
           [class.text-gray-600]="activeTab !== 'pendientes'">
          Pendientes
        </p>
      </button>

      <!-- Tab: En Tránsito -->
      <button (click)="cambiarTab('custodia')"
              [class.bg-white]="activeTab === 'custodia'"
              [class.border-green-500]="activeTab === 'custodia'"
              [class.shadow-lg]="activeTab === 'custodia'"
              [class.bg-gray-50]="activeTab !== 'custodia'"
              [class.border-gray-200]="activeTab !== 'custodia'"
              class="relative p-6 rounded-2xl shadow-md border-2 transition-all hover:shadow-xl text-left">

        <!-- Badge Notificación -->
        <div *ngIf="kpiEnCustodia > 0 && activeTab !== 'custodia'"
             class="absolute -top-3 -right-3 bg-green-500 text-white text-sm font-bold w-10 h-10
                    rounded-full flex items-center justify-center shadow-lg border-4 border-white">
          {{ kpiEnCustodia }}
        </div>

        <div class="flex items-center justify-between mb-3">
          <div class="p-4 rounded-xl"
               [class.bg-green-100]="activeTab === 'custodia'"
               [class.text-green-600]="activeTab === 'custodia'"
               [class.bg-gray-100]="activeTab !== 'custodia'"
               [class.text-gray-500]="activeTab !== 'custodia'">
            <app-icon name="user" [size]="32"></app-icon>
          </div>
          <div class="text-right">
            <p class="text-5xl font-bold"
               [class.text-green-600]="activeTab === 'custodia'"
               [class.text-gray-600]="activeTab !== 'custodia'">
              {{ kpiEnCustodia }}
            </p>
          </div>
        </div>

        <p class="text-sm font-bold uppercase tracking-wide"
           [class.text-green-600]="activeTab === 'custodia'"
           [class.text-gray-600]="activeTab !== 'custodia'">
          En Tránsito
        </p>
      </button>

    </div>

    <!-- ===================================================================
         LISTA DE TAREAS (Grid 2 columnas para Tablet)
         =================================================================== -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

      <!-- Loading State -->
      <div *ngIf="isLoading" class="lg:col-span-2 bg-white rounded-2xl shadow-md border border-gray-200">
        <div class="p-20 text-center">
          <div class="flex flex-col items-center gap-4">
            <div class="animate-spin text-hospital-cyan">
              <app-icon name="refresh-cw" [size]="56"></app-icon>
            </div>
            <span class="text-gray-600 font-medium text-lg">Cargando traslados...</span>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && tareasFiltradas.length === 0"
           class="lg:col-span-2 bg-white rounded-2xl shadow-md border border-gray-200">
        <div class="p-20 text-center">
          <div class="flex flex-col items-center gap-4">
            <div class="text-gray-300">
              <app-icon name="inbox" [size]="80"></app-icon>
            </div>
            <div>
              <p class="text-xl font-semibold text-gray-700">
                {{ activeTab === 'pendientes' ? 'Sin traslados pendientes' : 'Sin traslados en curso' }}
              </p>
              <p class="text-base text-gray-500 mt-2">
                {{
 activeTab === 'pendientes'
                   ? 'Las nuevas solicitudes aparecerán aquí'
                   : 'Escanea un QR para iniciar un traslado'
                }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Cards de Tareas (Grid 2 columnas) -->
      <div *ngFor="let tarea of tareasFiltradas"
           class="bg-white rounded-2xl shadow-md border-2 hover:shadow-xl transition-all overflow-hidden"
           [class.border-hospital-cyan]="activeTab === 'pendientes'"
           [class.border-green-500]="activeTab === 'custodia'">

        <!-- Header de la Card -->
        <div class="px-6 py-4 flex items-center justify-between"
             [class.bg-gradient-to-r]="true"
             [class.from-cyan-50]="activeTab === 'pendientes'"
             [class.to-cyan-100]="activeTab === 'pendientes'"
             [class.from-green-50]="activeTab === 'custodia'"
             [class.to-green-100]="activeTab === 'custodia'">

          <div class="flex items-center gap-3">
            <span class="px-4 py-1.5 rounded-full text-sm font-bold text-white"
                  [class.bg-hospital-cyan]="activeTab === 'pendientes'"
                  [class.bg-green-600]="activeTab === 'custodia'">
              {{ tarea.codigoExpediente }}
            </span>
            <span class="text-sm font-medium text-gray-600">SOLICITUD</span>
          </div>

          <div class="flex items-center gap-2 text-sm font-medium"
               [class.text-hospital-cyan]="activeTab === 'pendientes'"
               [class.text-green-600]="activeTab === 'custodia'">
            <app-icon name="clock" [size]="16"></app-icon>
            <span>{{ formatearTiempo(tarea.tiempoTranscurrido) }}</span>
          </div>
        </div>

        <!-- Body de la Card -->
        <div class="p-6">

          <!-- Paciente -->
          <div class="flex items-start gap-4 mb-5">
            <div class="p-4 rounded-xl flex-shrink-0"
                 [class.bg-cyan-100]="activeTab === 'pendientes'"
                 [class.text-hospital-cyan]="activeTab === 'pendientes'"
                 [class.bg-green-100]="activeTab === 'custodia'"
                 [class.text-green-600]="activeTab === 'custodia'">
              <app-icon name="user" [size]="32"></app-icon>
            </div>
            <div class="flex-1">
              <p class="font-bold text-gray-800 text-xl leading-tight mb-2">
                {{ tarea.nombreCompleto }}
              </p>
              <div class="flex items-center gap-2 text-base text-gray-600">
                <app-icon name="file-text" [size]="16"></app-icon>
                <span class="font-mono">{{ tarea.hc || 'N/A' }}</span>
              </div>
            </div>
          </div>

          <!-- Detalles: Origen y Destino -->
          <div class="grid grid-cols-2 gap-4 mb-5">
            <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
              <p class="text-xs text-gray-500 font-medium mb-1">Origen</p>
              <p class="text-base font-semibold text-gray-800">{{ tarea.servicio || 'N/A' }}</p>
            </div>
            <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
              <p class="text-xs text-gray-500 font-medium mb-1">Destino</p>
              <p class="text-base font-semibold text-gray-800">Mortuorio</p>
            </div>
          </div>

          <!-- Botón de Acción (Más grande para tablet) -->
          <button *ngIf="activeTab === 'pendientes'"
                  (click)="escanearQR()"
                  class="w-full py-4 bg-hospital-cyan text-white rounded-xl font-bold text-base
                         hover:bg-cyan-700 transition-colors flex items-center justify-center gap-3
                         shadow-md hover:shadow-lg">
            <app-icon name="qr-code" [size]="24"></app-icon>
            <span>ESCANEAR Y RECOGER</span>
          </button>

          <button *ngIf="activeTab === 'custodia'"
                  (click)="irAAsignarBandeja(tarea)"
                  class="w-full py-4 bg-green-600 text-white rounded-xl font-bold text-base
               hover:bg-green-700 transition-colors flex items-center justify-center gap-3
               shadow-md hover:shadow-lg">
            <app-icon name="map-pin" [size]="20"></app-icon>
            <span>ASIGNAR BANDEJA</span>
          </button>
        </div>

      </div>

    </div>

  </div>

  <!-- ===================================================================
       FAB (Botón Flotante - Solo si hay tareas pendientes)
       =================================================================== -->
  <button *ngIf="activeTab === 'pendientes' && tareasFiltradas.length > 0"
          (click)="escanearQR()"
          class="fixed bottom-8 right-8 h-20 w-20 bg-hospital-cyan text-white rounded-full
                 shadow-2xl flex items-center justify-center z-40 hover:scale-110 transition-transform
                 border-4 border-white animate-pulse">
    <app-icon name="qr-code" [size]="24"></app-icon>
  </button>

</div>

<div class="min-h-screen bg-hospital-bg">

  <!-- Header -->
  <div class="bg-white border-b border-gray-200 px-6 py-4 sticky top-0 z-10 shadow-sm">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 bg-hospital-green rounded-lg flex items-center justify-center shadow-md text-white">
          <app-icon name="inbox" [size]="24"></app-icon>
        </div>
        <div>
          <h1 class="text-xl font-bold text-gray-800">Bandeja de Entrada</h1>
          <p class="text-xs text-gray-500">Pacientes pendientes de generar expediente</p>
        </div>
      </div>

      <!-- Contador rápido -->
      <div class="hidden md:flex items-center gap-2 bg-green-50 px-4 py-2 rounded-lg border border-green-200">
        <app-icon name="alert-circle" [size]="18"></app-icon>
        <span class="text-sm font-bold text-green-700">{{ totalPendientes }} pendiente(s)</span>
      </div>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="max-w-7xl mx-auto p-6 space-y-6">

    <!-- Filtros y búsqueda -->
    <div class="card animate-fade-in">
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

          <!-- Búsqueda -->
          <div class="md:col-span-2">
            <label class="block text-xs font-bold text-gray-600 uppercase mb-2">Buscar</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                <app-icon name="file-text" [size]="18"></app-icon>
              </div>
              <input type="text"
                     [(ngModel)]="searchTerm"
                     (input)="aplicarFiltros()"
                     placeholder="HC, nombre, documento..."
                     class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-hospital-green focus:border-transparent">
            </div>
          </div>

          <!-- Filtro por servicio -->
          <div>
            <label class="block text-xs font-bold text-gray-600 uppercase mb-2">Servicio</label>
            <select [(ngModel)]="filtroServicio"
                    (change)="aplicarFiltros()"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-hospital-green">
              <option value="">Todos</option>
              <option *ngFor="let srv of servicios" [value]="srv">{{ srv }}</option>
            </select>
          </div>

          <!-- Filtro por fecha -->
          <div>
            <label class="block text-xs font-bold text-gray-600 uppercase mb-2">Fecha</label>
            <select [(ngModel)]="filtroFecha"
                    (change)="aplicarFiltros()"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-hospital-green">
              <option value="todas">Todas</option>
              <option value="hoy">Hoy</option>
              <option value="ayer">Ayer</option>
              <option value="semana">Esta semana</option>
            </select>
          </div>

        </div>
      </div>
    </div>

    <!-- Tabla de pacientes -->
    <div class="card overflow-hidden animate-fade-in-up" style="animation-delay: 0.1s">

      <!-- Header de tabla -->
      <div class="px-6 py-4 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200 flex justify-between items-center">
        <h3 class="font-bold text-gray-700 flex items-center gap-2">
          <span class="text-gray-500 flex items-center">
            <app-icon name="file-text" [size]="20"></app-icon>
          </span>
          Pacientes Pendientes
        </h3>
        <button (click)="recargar()"
                class="p-2 text-gray-400 hover:text-hospital-green hover:bg-green-50 rounded-lg transition-all hover:scale-110"
                title="Recargar">
          <app-icon name="refresh-cw" [size]="18"></app-icon>
        </button>
      </div>

      <!-- Tabla -->
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead class="bg-gray-50 text-xs uppercase font-bold text-gray-600 border-b-2 border-gray-200">
            <tr>
              <th class="px-6 py-4 cursor-pointer hover:bg-gray-100 transition-colors" (click)="ordenarPor('hc')">
                <div class="flex items-center gap-2">
                  <span>HC</span>
                  <app-icon name="chevron-up" [size]="14" *ngIf="ordenColumna === 'hc' && ordenDireccion === 'asc'"></app-icon>
                  <app-icon name="chevron-down" [size]="14" *ngIf="ordenColumna === 'hc' && ordenDireccion === 'desc'"></app-icon>
                </div>
              </th>
              <th class="px-6 py-4 cursor-pointer hover:bg-gray-100 transition-colors" (click)="ordenarPor('nombre')">
                <div class="flex items-center gap-2">
                  <span>Paciente</span>
                  <app-icon name="chevron-up" [size]="14" *ngIf="ordenColumna === 'nombre' && ordenDireccion === 'asc'"></app-icon>
                  <app-icon name="chevron-down" [size]="14" *ngIf="ordenColumna === 'nombre' && ordenDireccion === 'desc'"></app-icon>
                </div>
              </th>
              <th class="px-6 py-4">Documento</th>
              <th class="px-6 py-4">Servicio</th>
              <th class="px-6 py-4 cursor-pointer hover:bg-gray-100 transition-colors" (click)="ordenarPor('fecha')">
                <div class="flex items-center gap-2">
                  <span>Fecha Fallecimiento</span>
                  <app-icon name="chevron-up" [size]="14" *ngIf="ordenColumna === 'fecha' && ordenDireccion === 'asc'"></app-icon>
                  <app-icon name="chevron-down" [size]="14" *ngIf="ordenColumna === 'fecha' && ordenDireccion === 'desc'"></app-icon>
                </div>
              </th>
              <th class="px-6 py-4 text-center">Acción</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-100">

            <!-- Loading -->
            <tr *ngIf="isLoading">
              <td colspan="6" class="px-6 py-12 text-center">
                <div class="flex flex-col items-center gap-3">
                  <div class="animate-spin text-gray-400">
                    <app-icon name="refresh-cw" [size]="32"></app-icon>
                  </div>
                  <span class="text-gray-500">Cargando pacientes pendientes...</span>
                </div>
              </td>
            </tr>

            <!-- Error -->
            <tr *ngIf="errorMessage && !isLoading">
              <td colspan="6" class="px-6 py-8 text-center text-red-600">
                <div class="flex flex-col items-center gap-2">
                  <app-icon name="alert-circle" [size]="24"></app-icon>
                  {{ errorMessage }}
                </div>
              </td>
            </tr>

            <!-- Empty -->
            <tr *ngIf="!isLoading && !errorMessage && pendientesFiltrados.length === 0">
              <td colspan="6" class="px-6 py-12 text-center">
                <div class="flex flex-col items-center gap-3">
                  <div class="text-gray-400">
                    <app-icon name="inbox" [size]="40"></app-icon>
                  </div>
                  <p class="text-gray-500 font-medium">No hay pacientes pendientes</p>
                  <p class="text-xs text-gray-400">Los expedientes generados aparecerán en el Dashboard</p>
                </div>
              </td>
            </tr>

            <!-- Data rows -->
            <tr *ngFor="let p of pendientesPaginados"
                class="hover:bg-green-50 transition-all group">
              <td class="px-6 py-4 font-mono text-sm font-bold text-hospital-green">
                {{ p.hc }}
              </td>
              <td class="px-6 py-4">
                <div class="font-semibold text-gray-800">
                  {{ p.apellidoPaterno }} {{ p.apellidoMaterno }}, {{ p.nombres }}
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  {{ p.sexo === 'M' ? 'Masculino' : 'Femenino' }}
                </div>
              </td>
              <td class="px-6 py-4 text-gray-600">
                <div class="text-xs text-gray-500">{{ getTipoDocumento(p.tipoDocumentoID) }}</div>
                <div class="font-mono text-sm">{{ p.numeroDocumento }}</div>
              </td>
              <td class="px-6 py-4">
                <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs font-semibold rounded">
                  {{ p.servicioFallecimiento || 'Desconocido' }}
                </span>
              </td>
              <td class="px-6 py-4 text-gray-600">
                {{ p.fechaHoraFallecimiento | date:'dd/MM/yyyy HH:mm' }}
              </td>
              <td class="px-6 py-4 text-center">
                <button (click)="generarExpediente(p.hc)"
                        class="btn-primary text-xs px-4 py-2 flex items-center gap-2 mx-auto group-hover:scale-105 transition-transform">
                  <app-icon name="file-plus" [size]="16"></app-icon>
                  <span>Generar Expediente</span>
                </button>
              </td>
            </tr>

          </tbody>
        </table>
      </div>

      <!-- Paginación -->
      <div *ngIf="!isLoading && pendientesFiltrados.length > 0"
           class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="text-sm text-gray-600">
          Mostrando <strong>{{ paginaInicio + 1 }}</strong> a <strong>{{ paginaFin }}</strong> de <strong>{{ totalFiltrados }}</strong> resultados
        </div>
        <div class="flex items-center gap-2">
          <button (click)="paginaAnterior()"
                  [disabled]="paginaActual === 1"
                  class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
            <app-icon name="chevron-left" [size]="18"></app-icon>
          </button>
          <span class="px-4 py-2 text-sm font-medium">
            Página {{ paginaActual }} de {{ totalPaginas }}
          </span>
          <button (click)="paginaSiguiente()"
                  [disabled]="paginaActual === totalPaginas"
                  class="p-2 border border-gray-300 rounded-lg hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
            <app-icon name="chevron-right" [size]="18"></app-icon>
          </button>
        </div>
      </div>

    </div>

  </div>

</div>

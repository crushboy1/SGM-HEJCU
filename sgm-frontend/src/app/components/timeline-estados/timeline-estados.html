<div class="timeline-container py-4">

  <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-6 pl-2">
    Flujo de Aprobaci√≥n
  </h4>

  <div class="relative space-y-8 pl-2">

    <div class="absolute top-2 bottom-2 left-[19px] w-0.5 bg-gray-200 -z-10"></div>

    <div *ngFor="let step of timeline; let isLast = last"
         class="relative flex gap-4 group">

      <div class="relative">
        <div class="w-10 h-10 rounded-full flex items-center justify-center border-4 border-white shadow-sm transition-all duration-300 z-10"
             [ngClass]="[
               step.activo ? 'scale-110 ring-4 ring-offset-0 ring-opacity-20' : '',
               step.activo ? step.color.replace('text-', 'ring-') : '',
               step.completado || step.activo ? step.color : 'bg-gray-100 text-gray-400 border-gray-200'
             ]">
          <app-icon [name]="step.icono" [size]="18"></app-icon>
        </div>

        <div *ngIf="step.completado && !isLast"
             class="absolute top-10 left-1/2 -translate-x-1/2 w-0.5 h-[calc(100%+2rem)] bg-hospital-green -z-10">
        </div>
      </div>

      <div class="flex-1 pt-1 pb-4">

        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-1">
          <h5 class="text-sm font-bold transition-colors duration-200"
              [ngClass]="step.activo || step.completado ? 'text-gray-800' : 'text-gray-400'">
            {{ step.label }}
          </h5>

          <span *ngIf="step.fecha"
                class="text-xs font-medium px-2 py-0.5 rounded-full bg-gray-100 text-gray-600 border border-gray-200 flex items-center gap-1 w-fit mt-1 sm:mt-0">
            <app-icon name="calendar" [size]="12"></app-icon>
            {{ step.fecha | date:'dd/MM/yy HH:mm' }}
          </span>
        </div>

        <div *ngIf="step.usuario" class="text-xs text-gray-600 flex items-center gap-1.5 mb-2">
          <app-icon name="user" [size]="12" class="text-gray-400"></app-icon>
          <span class="font-medium">{{ step.usuario }}</span>
        </div>

        <p *ngIf="!step.fecha && !step.activo" class="text-xs text-gray-400 italic">
          Pendiente de proceso...
        </p>

        <div *ngIf="step.observaciones"
             class="mt-2 text-xs p-3 rounded-lg border-l-4 bg-white shadow-sm"
             [ngClass]="step.label.includes('Rechaza') ? 'border-l-red-500 bg-red-50 text-red-800' : 'border-l-blue-400 bg-blue-50 text-blue-800'">
          <div class="font-bold mb-0.5 flex items-center gap-1">
            <app-icon name="message-square" [size]="12"></app-icon>
            Observaciones:
          </div>
          {{ step.observaciones }}
        </div>

        <div *ngIf="step.activo" class="mt-2 inline-flex items-center gap-1.5 text-xs font-bold text-hospital-blue animate-pulse">
          <span class="w-2 h-2 rounded-full bg-hospital-blue"></span>
          En proceso actual
        </div>

      </div>
    </div>

  </div>
</div>
